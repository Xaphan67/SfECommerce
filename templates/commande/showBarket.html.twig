{% extends 'base.html.twig' %}

{% block title %}E-Commerce - Votre panier{% endblock %}

{% block body %}
    <div class="conteneur-principal">
        <div class="categories">
            <h2>Votre panier</h2>
            <div class="conteneur-categories">
                {% if commande %}
                    <div class="conteneur conteneur-padding">
                        <h2>Votre panier contient {{ commande.produitCommandes | length }} produit{{ commande.produitCommandes | length != 1 ? "s" : "" }}</h2>
                        <div class="liste">
                        {% for produitCommande in commande.produitCommandes %}
                                <div class="panier-produit">
                                    <div class="produit-image">
                                        <img src="{{ asset('img/produits/' ~ produitCommande.produit.categorie | lower | replace({ 'á':'a', 'é':'e', 'è':'e', 'í':'i', 'ó':'o', 'ú':'u' }) ~ '/' ~ produitCommande.produit.photo) }}" alt="{{ produitCommande.produit.designation }}">
                                    </div>
                                    <div class="produit-infos">
                                        <span class="produit-designation"><a href="">{{ produitCommande.produit.designation }}</a></span>
                                        <span>
                                            Disponibilité :
                                            {% if produitCommande.produit.disponible %}
                                                <span class="stock-oui">EN STOCK</span>
                                            {% else %}
                                                <span class="stock-non">RUPTURE</span>
                                            {% endif %}
                                        </span>
                                        <div class="panier-actions">
                                            <span>Quantité : {{ produitCommande.quantite }}</span>
                                            <span class="prix">{{ (produitCommande.produit.prix * produitCommande.quantite)  | number_format(2, '.') }} €</span>
                                            <a href="{{ path('supprimer_produit_commande', { 'id': produitCommande.produit.id }) }}"><img src="{{ asset('svg/commandes/supprimer.svg') }}" alt="supprimer le produit"></a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div> 
                    </div>
                    <div class="conteneur conteneur-padding">
                        <div class="panier-total">
                            <h2>Montant total de vos produits</h2>
                            <span class="panier-prix">{{ total | number_format(2, '.')}} €</span>
                        </div>
                        <a class="bouton-commander bouton-lien-centre" onclick="displayValidateForm()">Passer commande</a>
                    </div>
                {% else %}
                <div class="conteneur conteneur-padding">
                    <h2>Votre panier est vide</h2>
                    <img class="panier-vide" src="{{ asset('img/commandes/panier_vide.webp') }}" alt="votre panier est vide">
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div id="formulaire-commande" class="conteneur-modal">
            <div class="fermer-modal" onclick="closeModale()">
                <img class="modal-fermer" src="{{ asset('svg/fermer.svg') }}" alt="Fermer">
            </div>
            <h3>Passer commande</h3>
            <p>
                Remplissez les champs çi-dessous pour passer la commande<br>
                Si vous avez pré-remplis les champs dans votre profil, vous avez simplement besoin de vérifier les informations.
            </p>
            {{ form_start(formulaire, {'action': path('valider_commande'), 'method': 'POST'}) }}
                <div class="formulaire-champ">
                    {{ form_row(formulaire.civilite) }}
                </div>
                <div class="formulaire-champ">
                    {{ form_row(formulaire.nom) }}
                </div>
                <div class="formulaire-champ">
                    {{ form_row(formulaire.prenom) }}
                </div>
                <div class="formulaire-champ">
                    {{ form_row(formulaire.adresseFacturation) }}
                </div>
                <div class="formulaire-champ">
                    {{ form_row(formulaire.adresseLivraison) }}
                </div>
                <div class="bouton-centre">
                    {{ form_row(formulaire.Valider) }}
                </div>
                {{ form_end(formulaire) }}
        </div>
    </div>

    <script>
        // Affiche le formulaire de validation de la commande
        function displayValidateForm() {
            const modal = document.getElementById("modal")
            const element = document.getElementById("formulaire-commande")
            const stylesModal = window.getComputedStyle(modal)
            if (stylesModal.getPropertyValue("display") == "none") {
                element.style.display = "block";
                modal.style.display = "flex";
            }
        }

        // ferme la modale
        function closeModale()
        {
            const modal = document.getElementById("modal")
            const element = document.getElementById("formulaire-commande")
            element.style.display = "none";
            modal.style.display = "none";
        }
    </script>
{% endblock %}
